<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¼ë¯¸í™”ëˆ ê³ ê¸° ë°œì£¼í”„ë¡œê·¸ë¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .card h3 { font-size: 0.9em; margin-bottom: 10px; opacity: 0.9; }
        .card .value { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .card .label { font-size: 0.8em; opacity: 0.8; }
        .section {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        td { padding: 15px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f8f9fa; }
        input[type="number"], input[type="date"], select {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .warning { color: #e74c3c; font-weight: bold; }
        .safe { color: #27ae60; font-weight: bold; }
        .alert { color: #f39c12; font-weight: bold; }
        .priority-high { background: #ffe5e5 !important; }
        .priority-medium { background: #fff4e5 !important; }
        .priority-low { background: #e5f7e5 !important; }
        .button-group { text-align: center; margin-top: 20px; }
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status-waiting { background: #e3f2fd; color: #1976d2; }
        .status-ready { background: #e8f5e9; color: #388e3c; }
        .status-urgent { background: #ffebee; color: #c62828; }
        .usage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .usage-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .usage-item label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        .usage-item input {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥© ì‚¼ë¯¸í™”ëˆ ê³ ê¸° ë°œì£¼í”„ë¡œê·¸ë¨</h1>
        <p class="subtitle">10~14ì¼ ìˆ™ì„± ê¸°ë°˜ ì„ ì…ì„ ì¶œ(FIFO) ìë™ ê³„ì‚°</p>

        <div class="dashboard">
            <div class="card">
                <h3>ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ</h3>
                <div class="value" id="today"></div>
                <div class="label">í˜„ì¬ ê¸°ì¤€</div>
            </div>
            <div class="card">
                <h3>âš ï¸ ê¸´ê¸‰ ë°œì£¼ í•„ìš”</h3>
                <div class="value" id="urgentCount">0</div>
                <div class="label">í’ˆëª©</div>
            </div>
            <div class="card">
                <h3>ğŸ“¦ ì´ ì¬ê³ </h3>
                <div class="value" id="totalStock">0</div>
                <div class="label">íŒ©</div>
            </div>
            <div class="card">
                <h3>âœ… ì˜¤ëŠ˜ ì‚¬ìš©ê°€ëŠ¥</h3>
                <div class="value" id="todayAvailable">0</div>
                <div class="label">íŒ©</div>
            </div>
        </div>

        <!-- ìƒˆë¡œ ì¶”ê°€: ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰ ì…ë ¥ -->
        <div class="section">
            <h2>ğŸ– 0. ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰ ì…ë ¥</h2>
            <div class="usage-grid">
                <div class="usage-item">
                    <label>ëª©ì‚´</label>
                    <input type="number" id="usageëª©ì‚´" value="0" min="0" step="0.5">
                </div>
                <div class="usage-item">
                    <label>ì‚¼ê²¹ì‚´</label>
                    <input type="number" id="usageì‚¼ê²¹ì‚´" value="0" min="0" step="0.5">
                </div>
                <div class="usage-item">
                    <label>ê°€ë¸Œë¦¬ì‚´</label>
                    <input type="number" id="usageê°€ë¸Œë¦¬ì‚´" value="0" min="0" step="0.5">
                </div>
                <div class="usage-item">
                    <label>í•­ì •ì‚´</label>
                    <input type="number" id="usageí•­ì •ì‚´" value="0" min="0" step="0.5">
                </div>
            </div>
            <div class="button-group">
                <button onclick="recordUsage()">âœ… ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰ ê¸°ë¡</button>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;">
                <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong> ì˜¤ëŠ˜ ì‹¤ì œë¡œ ì‚¬ìš©í•œ ì–‘ì„ ì…ë ¥í•˜ê³  "ê¸°ë¡" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìë™ìœ¼ë¡œ ì¬ê³ ì—ì„œ ì°¨ê°ë©ë‹ˆë‹¤.
            </div>
        </div>

        <!-- ìƒˆë¡œ ì¶”ê°€: ì‚¬ìš© ë‚´ì—­ -->
        <div class="section">
            <h2>ğŸ“Š ìµœê·¼ ì‚¬ìš© ë‚´ì—­ (7ì¼)</h2>
            <table>
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ëª©ì‚´</th>
                        <th>ì‚¼ê²¹ì‚´</th>
                        <th>ê°€ë¸Œë¦¬ì‚´</th>
                        <th>í•­ì •ì‚´</th>
                        <th>í•©ê³„</th>
                    </tr>
                </thead>
                <tbody id="usageHistory"></tbody>
            </table>
        </div>

        <div class="section">
            <h2>ğŸ“ 1. ë°œì£¼ ì…ë ¥</h2>
            <table>
                <thead>
                    <tr>
                        <th>ë°œì£¼ì¼</th>
                        <th>í’ˆëª©</th>
                        <th>ìˆ˜ëŸ‰(íŒ©)</th>
                        <th>ì…ê³ ì¼</th>
                        <th>ì‚¬ìš©ê°€ëŠ¥ì¼(10ì¼)</th>
                        <th>ë§ˆê°ì¼(14ì¼)</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="date" id="orderDate"></td>
                        <td>
                            <select id="meatType">
                                <option value="ëª©ì‚´">ëª©ì‚´</option>
                                <option value="ì‚¼ê²¹ì‚´">ì‚¼ê²¹ì‚´</option>
                                <option value="ê°€ë¸Œë¦¬ì‚´">ê°€ë¸Œë¦¬ì‚´</option>
                                <option value="í•­ì •ì‚´">í•­ì •ì‚´</option>
                            </select>
                        </td>
                        <td><input type="number" id="orderQty" value="4" min="1"></td>
                        <td id="receiveDate"></td>
                        <td id="startDate"></td>
                        <td id="endDate"></td>
                        <td><button onclick="addOrder()">ì¶”ê°€</button></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>ğŸ“‹ 2. ë°œì£¼ ê¸°ë¡</h2>
            <table>
                <thead>
                    <tr>
                        <th>ë°œì£¼ì¼</th>
                        <th>ì…ê³ ì¼</th>
                        <th>í’ˆëª©</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>ì‚¬ìš©ê°€ëŠ¥ì¼</th>
                        <th>ë§ˆê°ì¼</th>
                        <th>ë‚¨ì€ì¼ìˆ˜</th>
                        <th>ìƒíƒœ</th>
                        <th>ì‚­ì œ</th>
                    </tr>
                </thead>
                <tbody id="orderHistory"></tbody>
            </table>
        </div>

        <div class="section">
            <h2>âœ… 3. ì˜¤ëŠ˜ ì‚¬ìš© ê°€ëŠ¥í•œ ê³ ê¸° (10~14ì¼ ìˆ™ì„±ë¶„)</h2>
            <table>
                <thead>
                    <tr>
                        <th>ìš°ì„ ìˆœìœ„</th>
                        <th>í’ˆëª©</th>
                        <th>ì…ê³ ì¼</th>
                        <th>ìˆ™ì„±ì¼ìˆ˜</th>
                        <th>ì‚¬ìš©ê°€ëŠ¥ ê¸°ê°„</th>
                        <th>ìˆ˜ëŸ‰</th>
                        <th>ë§ˆê°ê¹Œì§€</th>
                    </tr>
                </thead>
                <tbody id="availableMeat"></tbody>
            </table>
        </div>

        <div class="section">
            <h2>ğŸ¯ 4. ì¼ì£¼ì¼ ë°œì£¼ ê³„íš (ìë™ ê³„ì‚°)</h2>
            <table>
                <thead>
                    <tr>
                        <th>í’ˆëª©</th>
                        <th>ì¼ì¼ ì‚¬ìš©ëŸ‰</th>
                        <th>7ì¼ í•„ìš”ëŸ‰</th>
                        <th>í˜„ì¬ ì¬ê³ <br>(10~14ì¼ë¶„)</th>
                        <th>ë¶€ì¡±ë¶„</th>
                        <th>ê¶Œì¥ ë°œì£¼ëŸ‰<br>(+ì•ˆì „ë§ˆì§„)</th>
                        <th>ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody id="weeklyPlan"></tbody>
            </table>
            <div class="button-group">
                <button onclick="calculateWeeklyPlan()">ğŸ”„ ë°œì£¼ ê³„íš ìƒˆë¡œê³ ì¹¨</button>
                <button onclick="autoOrder()">âš¡ ë¶€ì¡±ë¶„ ìë™ ë°œì£¼</button>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“Š 5. ì¬ê³  í˜„í™© (í’ˆëª©ë³„)</h2>
            <table>
                <thead>
                    <tr>
                        <th>í’ˆëª©</th>
                        <th>ì´ ì¬ê³ </th>
                        <th>ëŒ€ê¸°ì¤‘(0~9ì¼)</th>
                        <th>ì‚¬ìš©ê°€ëŠ¥(10~14ì¼)</th>
                        <th>ì•ˆì „ì¬ê³ (10ì¼ë¶„)</th>
                        <th>ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody id="stockStatus"></tbody>
            </table>
        </div>

        <div class="button-group">
            <button onclick="exportData()">ğŸ’¾ ë°ì´í„° ì €ì¥</button>
            <button onclick="importData()">ğŸ“‚ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button onclick="resetAll()">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
    </div>

    <script>
        let orders = [];
        let usageRecords = []; // ìƒˆë¡œ ì¶”ê°€: ì‚¬ìš© ë‚´ì—­
        const dailyUsage = {'ëª©ì‚´': 4, 'ì‚¼ê²¹ì‚´': 1, 'ê°€ë¸Œë¦¬ì‚´': 1, 'í•­ì •ì‚´': 1};
        const safetyStock = {'ëª©ì‚´': 40, 'ì‚¼ê²¹ì‚´': 10, 'ê°€ë¸Œë¦¬ì‚´': 10, 'í•­ì •ì‚´': 10};

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            const today = new Date();
            document.getElementById('orderDate').value = formatDate(today);
            calculateDates();
            updateAllTables();
            document.getElementById('orderDate').addEventListener('change', calculateDates);
        });

        // ìƒˆë¡œ ì¶”ê°€: ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰ ê¸°ë¡
        function recordUsage() {
            const today = formatDate(new Date());
            const meats = ['ëª©ì‚´', 'ì‚¼ê²¹ì‚´', 'ê°€ë¸Œë¦¬ì‚´', 'í•­ì •ì‚´'];
            const usage = {};
            let totalUsage = 0;

            meats.forEach(meat => {
                const qty = parseFloat(document.getElementById(`usage${meat}`).value) || 0;
                usage[meat] = qty;
                totalUsage += qty;
            });

            if(totalUsage === 0) {
                alert('âš ï¸ ì‚¬ìš©ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            // ì¬ê³ ì—ì„œ ì°¨ê° (ê°€ì¥ ì˜¤ë˜ëœ ê²ƒë¶€í„°)
            meats.forEach(meat => {
                let remainingUsage = usage[meat];
                if(remainingUsage === 0) return;

                const availableOrders = orders.filter(o => {
                    if(o.meatType !== meat) return false;
                    const agingDays = Math.ceil((new Date() - new Date(o.receiveDate)) / (1000*60*60*24));
                    return agingDays >= 10 && agingDays <= 14 && o.quantity > 0;
                }).sort((a, b) => new Date(a.receiveDate) - new Date(b.receiveDate));

                for(let order of availableOrders) {
                    if(remainingUsage === 0) break;
                    
                    if(order.quantity >= remainingUsage) {
                        order.quantity -= remainingUsage;
                        remainingUsage = 0;
                    } else {
                        remainingUsage -= order.quantity;
                        order.quantity = 0;
                    }
                }

                if(remainingUsage > 0) {
                    alert(`âš ï¸ ${meat} ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! ${remainingUsage}íŒ© ë¶€ì¡±`);
                }
            });

            // ì‚¬ìš© ë‚´ì—­ ì €ì¥
            usageRecords.push({
                date: today,
                usage: usage
            });

            // ìµœê·¼ 30ì¼ë§Œ ë³´ê´€
            if(usageRecords.length > 30) {
                usageRecords = usageRecords.slice(-30);
            }

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            meats.forEach(meat => {
                document.getElementById(`usage${meat}`).value = '0';
            });

            saveData();
            updateAllTables();
            alert('âœ… ì‚¬ìš©ëŸ‰ ê¸°ë¡ ì™„ë£Œ!');
        }

        // ìƒˆë¡œ ì¶”ê°€: ì‚¬ìš© ë‚´ì—­ í‘œì‹œ
        function updateUsageHistory() {
            const tbody = document.getElementById('usageHistory');
            const recent = usageRecords.slice(-7).reverse();
            
            tbody.innerHTML = recent.map(record => {
                const total = Object.values(record.usage).reduce((sum, val) => sum + val, 0);
                return `<tr>
                    <td>${record.date}</td>
                    <td>${record.usage['ëª©ì‚´']}íŒ©</td>
                    <td>${record.usage['ì‚¼ê²¹ì‚´']}íŒ©</td>
                    <td>${record.usage['ê°€ë¸Œë¦¬ì‚´']}íŒ©</td>
                    <td>${record.usage['í•­ì •ì‚´']}íŒ©</td>
                    <td><strong>${total}íŒ©</strong></td>
                </tr>`;
            }).join('');

            if(recent.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#999;">ì•„ì§ ì‚¬ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        function calculateDates() {
            const orderDate = new Date(document.getElementById('orderDate').value);
            const receiveDate = new Date(orderDate);
            receiveDate.setDate(receiveDate.getDate() + 1);
            const startDate = new Date(receiveDate);
            startDate.setDate(startDate.getDate() + 10);
            const endDate = new Date(receiveDate);
            endDate.setDate(endDate.getDate() + 14);
            document.getElementById('receiveDate').textContent = formatDate(receiveDate);
            document.getElementById('startDate').textContent = formatDate(startDate);
            document.getElementById('endDate').textContent = formatDate(endDate);
        }

        function addOrder() {
            const orderDate = document.getElementById('orderDate').value;
            const meatType = document.getElementById('meatType').value;
            const qty = parseInt(document.getElementById('orderQty').value);
            const order = {
                id: Date.now(),
                orderDate: orderDate,
                receiveDate: addDays(orderDate, 1),
                meatType: meatType,
                quantity: qty,
                startDate: addDays(orderDate, 11),
                endDate: addDays(orderDate, 15)
            };
            orders.push(order);
            saveData();
            updateAllTables();
            alert(`âœ… ${meatType} ${qty}íŒ© ë°œì£¼ ë“±ë¡ ì™„ë£Œ!`);
        }

        function deleteOrder(id) {
            if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                orders = orders.filter(o => o.id !== id);
                saveData();
                updateAllTables();
            }
        }

        function updateAllTables() {
            updateOrderHistory();
            updateAvailableMeat();
            updateStockStatus();
            calculateWeeklyPlan();
            updateDashboard();
            updateUsageHistory(); // ìƒˆë¡œ ì¶”ê°€
        }

        function updateOrderHistory() {
            const tbody = document.getElementById('orderHistory');
            const today = new Date();
            tbody.innerHTML = orders.map(order => {
                const daysLeft = Math.ceil((new Date(order.endDate) - today) / (1000*60*60*24));
                const agingDays = Math.ceil((today - new Date(order.receiveDate)) / (1000*60*60*24));
                let status = '', rowClass = '';
                if(agingDays < 10) {
                    status = '<span class="status-waiting">ìˆ™ì„±ì¤‘</span>';
                } else if(agingDays >= 10 && agingDays <= 14) {
                    status = '<span class="status-ready">ì‚¬ìš©ê°€ëŠ¥</span>';
                    rowClass = agingDays >= 13 ? 'priority-high' : 'priority-low';
                } else {
                    status = '<span class="status-urgent">íê¸°ìœ„í—˜</span>';
                    rowClass = 'priority-high';
                }
                return `<tr class="${rowClass}">
                    <td>${order.orderDate}</td>
                    <td>${order.receiveDate}</td>
                    <td><strong>${order.meatType}</strong></td>
                    <td>${order.quantity}íŒ©</td>
                    <td>${order.startDate}</td>
                    <td>${order.endDate}</td>
                    <td>${daysLeft > 0 ? daysLeft + 'ì¼' : 'ë§ˆê°'}</td>
                    <td>${status}</td>
                    <td><button onclick="deleteOrder(${order.id})" style="background:#e74c3c; padding:5px 10px;">ì‚­ì œ</button></td>
                </tr>`;
            }).join('');
        }

        function updateAvailableMeat() {
            const tbody = document.getElementById('availableMeat');
            const today = new Date();
            const available = orders.filter(order => {
                const agingDays = Math.ceil((today - new Date(order.receiveDate)) / (1000*60*60*24));
                return agingDays >= 10 && agingDays <= 14 && order.quantity > 0;
            }).sort((a, b) => new Date(a.receiveDate) - new Date(b.receiveDate));
            tbody.innerHTML = available.map((order, index) => {
                const agingDays = Math.ceil((today - new Date(order.receiveDate)) / (1000*60*60*24));
                const daysLeft = Math.ceil((new Date(order.endDate) - today) / (1000*60*60*24));
                let priority = 'ğŸŸ¢', rowClass = 'priority-low';
                if(daysLeft <= 1) { priority = 'ğŸ”´'; rowClass = 'priority-high'; }
                else if(daysLeft <= 2) { priority = 'ğŸŸ¡'; rowClass = 'priority-medium'; }
                return `<tr class="${rowClass}">
                    <td>${priority} ${index + 1}ìˆœìœ„</td>
                    <td><strong>${order.meatType}</strong></td>
                    <td>${order.receiveDate}</td>
                    <td>${agingDays}ì¼</td>
                    <td>${order.startDate} ~ ${order.endDate}</td>
                    <td>${order.quantity}íŒ©</td>
                    <td class="${daysLeft <= 1 ? 'warning' : 'safe'}">${daysLeft}ì¼</td>
                </tr>`;
            }).join('');
        }

        function updateStockStatus() {
            const tbody = document.getElementById('stockStatus');
            const today = new Date();
            const meats = ['ëª©ì‚´', 'ì‚¼ê²¹ì‚´', 'ê°€ë¸Œë¦¬ì‚´', 'í•­ì •ì‚´'];
            tbody.innerHTML = meats.map(meat => {
                const meatOrders = orders.filter(o => o.meatType === meat);
                let total = 0, waiting = 0, available = 0;
                meatOrders.forEach(order => {
                    const agingDays = Math.ceil((today - new Date(order.receiveDate)) / (1000*60*60*24));
                    total += order.quantity;
                    if(agingDays < 10) waiting += order.quantity;
                    else if(agingDays >= 10 && agingDays <= 14) available += order.quantity;
                });
                const safety = safetyStock[meat];
                let status = '';
                if(available < safety * 0.5) status = '<span class="warning">ğŸ”´ ê¸´ê¸‰ë°œì£¼</span>';
                else if(available < safety) status = '<span class="alert">ğŸŸ¡ ë°œì£¼ê¶Œì¥</span>';
                else status = '<span class="safe">ğŸŸ¢ ì•ˆì „</span>';
                return `<tr>
                    <td><strong>${meat}</strong></td>
                    <td>${total}íŒ©</td>
                    <td>${waiting}íŒ©</td>
                    <td>${available}íŒ©</td>
                    <td>${safety}íŒ©</td>
                    <td>${status}</td>
                </tr>`;
            }).join('');
        }

        function calculateWeeklyPlan() {
            const tbody = document.getElementById('weeklyPlan');
            const today = new Date();
            const meats = ['ëª©ì‚´', 'ì‚¼ê²¹ì‚´', 'ê°€ë¸Œë¦¬ì‚´', 'í•­ì •ì‚´'];
            tbody.innerHTML = meats.map(meat => {
                const daily = dailyUsage[meat];
                const weekly = daily * 7;
                const available = orders.filter(o => o.meatType === meat)
                    .filter(o => {
                        const agingDays = Math.ceil((today - new Date(o.receiveDate)) / (1000*60*60*24));
                        return agingDays >= 10 && agingDays <= 14;
                    })
                    .reduce((sum, o) => sum + o.quantity, 0);
                const shortage = Math.max(0, weekly - available);
                const recommended = shortage + (daily * 3);
                let status = shortage > 0 ? '<span class="warning">ğŸ”´ ë°œì£¼í•„ìš”</span>' : '<span class="safe">ğŸŸ¢ ì¶©ë¶„</span>';
                return `<tr>
                    <td><strong>${meat}</strong></td>
                    <td>${daily}íŒ©/ì¼</td>
                    <td>${weekly}íŒ©</td>
                    <td>${available}íŒ©</td>
                    <td class="${shortage > 0 ? 'warning' : 'safe'}">${shortage}íŒ©</td>
                    <td><strong>${recommended}íŒ©</strong></td>
                    <td>${status}</td>
                </tr>`;
            }).join('');
        }

        function autoOrder() {
            const today = new Date();
            const meats = ['ëª©ì‚´', 'ì‚¼ê²¹ì‚´', 'ê°€ë¸Œë¦¬ì‚´', 'í•­ì •ì‚´'];
            let orderCount = 0;
            meats.forEach(meat => {
                const daily = dailyUsage[meat];
                const weekly = daily * 7;
                const available = orders.filter(o => o.meatType === meat)
                    .filter(o => {
                        const agingDays = Math.ceil((today - new Date(o.receiveDate)) / (1000*60*60*24));
                        return agingDays >= 10 && agingDays <= 14;
                    })
                    .reduce((sum, o) => sum + o.quantity, 0);
                const shortage = Math.max(0, weekly - available);
                if(shortage > 0) {
                    const recommended = shortage + (daily * 3);
                    const order = {
                        id: Date.now() + orderCount,
                        orderDate: formatDate(today),
                        receiveDate: formatDate(addDays(formatDate(today), 1)),
                        meatType: meat,
                        quantity: recommended,
                        startDate: formatDate(addDays(formatDate(today), 11)),
                        endDate: formatDate(addDays(formatDate(today), 15))
                    };
                    orders.push(order);
                    orderCount++;
                }
            });
            if(orderCount > 0) {
                saveData();
                updateAllTables();
                alert(`âœ… ${orderCount}ê°œ í’ˆëª© ìë™ ë°œì£¼ ì™„ë£Œ!`);
            } else {
                alert('âœ… ëª¨ë“  í’ˆëª©ì´ ì¶©ë¶„í•©ë‹ˆë‹¤!');
            }
        }

        function updateDashboard() {
            const today = new Date();
            document.getElementById('today').textContent = formatDate(today);
            const meats = ['ëª©ì‚´', 'ì‚¼ê²¹ì‚´', 'ê°€ë¸Œë¦¬ì‚´', 'í•­ì •ì‚´'];
            let urgentCount = 0;
            meats.forEach(meat => {
                const available = orders.filter(o => o.meatType === meat)
                    .filter(o => {
                        const agingDays = Math.ceil((today - new Date(o.receiveDate)) / (1000*60*60*24));
                        return agingDays >= 10 && agingDays <= 14;
                    })
                    .reduce((sum, o) => sum + o.quantity, 0);
                if(available < safetyStock[meat] * 0.5) urgentCount++;
            });
            document.getElementById('urgentCount').textContent = urgentCount;
            document.getElementById('totalStock').textContent = orders.reduce((sum, o) => sum + o.quantity, 0);
            const todayAvailable = orders.filter(o => {
                const agingDays = Math.ceil((today - new Date(o.receiveDate)) / (1000*60*60*24));
                return agingDays >= 10 && agingDays <= 14;
            }).reduce((sum, o) => sum + o.quantity, 0);
            document.getElementById('todayAvailable').textContent = todayAvailable;
        }

        function formatDate(date) {
            if(typeof date === 'string') date = new Date(date);
            return date.toISOString().split('T')[0];
        }

        function addDays(dateStr, days) {
            const date = new Date(dateStr);
            date.setDate(date.getDate() + days);
            return formatDate(date);
        }

        function saveData() {
            localStorage.setItem('meatInventory', JSON.stringify(orders));
            localStorage.setItem('usageRecords', JSON.stringify(usageRecords)); // ìƒˆë¡œ ì¶”ê°€
        }

        function loadData() {
            const saved = localStorage.getItem('meatInventory');
            if(saved) orders = JSON.parse(saved);
            const savedUsage = localStorage.getItem('usageRecords'); // ìƒˆë¡œ ì¶”ê°€
            if(savedUsage) usageRecords = JSON.parse(savedUsage);
        }

        function exportData() {
            const data = {
                orders: orders,
                usageRecords: usageRecords // ìƒˆë¡œ ì¶”ê°€
            };
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ì¬ê³ ë°ì´í„°_${formatDate(new Date())}.json`;
            link.click();
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        orders = data.orders || data; // í•˜ìœ„ í˜¸í™˜ì„±
                        usageRecords = data.usageRecords || []; // ìƒˆë¡œ ì¶”ê°€
                        saveData();
                        updateAllTables();
                        alert('âœ… ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!');
                    } catch(err) {
                        alert('âŒ íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function resetAll() {
            if(confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                orders = [];
                usageRecords = []; // ìƒˆë¡œ ì¶”ê°€
                saveData();
                updateAllTables();
                alert('âœ… ì´ˆê¸°í™” ì™„ë£Œ');
            }
        }
    </script>
</body>
</html>
